<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Qual a lógica por trás de Core Data? Swift simplificado</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Qual a lógica por trás de Core Data? Swift simplificado</h1>
</header>
<section data-field="subtitle" class="p-summary">
Tentou aplicar Core Data e não entendeu por que as coisas são como são? Esse artigo te explica, em 5 minutos, tudo de maneira simplificada.
</section>
<section data-field="body" class="e-content">
<section name="9883" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--fullWidth"><figure name="5cbd" id="5cbd" class="graf graf--figure graf--layoutFillWidth graf--leading"><img class="graf-image" data-image-id="0*D17_sgDDVfbyZnpf" data-width="4256" data-height="2832" data-unsplash-photo-id="Q1p7bh3SHj8" src="https://cdn-images-1.medium.com/max/2560/0*D17_sgDDVfbyZnpf"><figcaption class="imageCaption">Photo by <a href="https://unsplash.com/@nasa?utm_source=medium&amp;utm_medium=referral" data-href="https://unsplash.com/@nasa?utm_source=medium&amp;utm_medium=referral" class="markup--anchor markup--figure-anchor" rel="photo-creator noopener" target="_blank">NASA</a> on <a href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" data-href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" class="markup--anchor markup--figure-anchor" rel="photo-source noopener" target="_blank">Unsplash</a></figcaption></figure></div><div class="section-inner sectionLayout--insetColumn"><h3 name="3334" id="3334" class="graf graf--h3 graf-after--figure graf--title">Swift simplificado: qual a lógica por trás de Core Data?</h3><p name="eeee" id="eeee" class="graf graf--p graf-after--h3">Pra quem quer trabalhar com apps mais robustos, persistência de dados é um tema que provavelmente se mostrará essencial. E, desenvolvendo em Swift, Core Data é um dos principais modos de persistir dados dentro de um app. A internet está cheia de tutorias sobre como implementar Core Data nas aplicações, mas as explicações sobre a lógica que existe por trás disso não são tão fáceis de compreender.</p><p name="73f3" id="73f3" class="graf graf--p graf-after--p">Nos próximos parágrafos, você entenderá quais são as principais classes que estão envolvidas no uso de Core Data e como elas se relacionam para cumprir o tão sonhado objetivo: persistir os seus dados.</p><p name="f095" id="f095" class="graf graf--p graf-after--p">Para isso, faremos uma pequena analogia, comparando o processo de armazenar dados ao de guardar itens de valor dentro de um banco.</p><h4 name="94ec" id="94ec" class="graf graf--h4 graf-after--p">Parte 1: O Banco</h4><p name="feb7" id="feb7" class="graf graf--p graf-after--h4">Imagine que, para poder comemorar uma grande conquista pessoal, resolvemos pegar nossas posses mais importantes no banco. Passamos pelos caixas eletrônicos, batemos na porta do gerente e, depois de colocar a conversa em dia, dizemos que queremos ir até o cofre. Em Core Data, estaríamos nos referiando ao…</p><p name="2b41" id="2b41" class="graf graf--p graf-after--p"><a href="https://developer.apple.com/documentation/coredata/nspersistentcontainer" data-href="https://developer.apple.com/documentation/coredata/nspersistentcontainer" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">NSPersistentContainer</strong></a>: é o grande cofre que guarda informações do nosso app em caráter permanente. Como o nome já diz, o Container é onde as informações persistem, sendo ele o ponto de início de nossa jornada.</p><figure name="38d3" id="38d3" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*kGSECZTbCNcwslh5k6OmlQ.jpeg" data-width="1920" data-height="1080" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*kGSECZTbCNcwslh5k6OmlQ.jpeg"><figcaption class="imageCaption">Em Core Data, o cofre do banco equivale ao Persistent Container.</figcaption></figure><p name="4664" id="4664" class="graf graf--p graf-after--figure">Entramos no imenso cofre. Como não somos milionários, não precisamos de um cofre inteiro só pra nós. Em vez disso, guardamos nossos itens em uma única gaveta desse cofre. Essa gaveta se chama…</p><p name="9413" id="9413" class="graf graf--p graf-after--p"><a href="https://developer.apple.com/documentation/coredata/nsmanagedobjectcontext" data-href="https://developer.apple.com/documentation/coredata/nsmanagedobjectcontext" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">NSManagedObjectContext</strong></a>: se o Container fosse o cofre de um grande banco, o Context seria como uma gaveta individual. É na nossa gaveta que guardamos as posses de grande valor, como joias, dinheiro ou documentos importantes. Da mesma forma, é no Context que os objetos criados pelo app ficam guardados, e sua principal função é auxiliar a registrar quaisquer mudanças que eles possam sofrer.</p><figure name="5bbe" id="5bbe" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*qCNSEjR44zyoXfBwIB_SdA.jpeg" data-width="600" data-height="322" src="https://cdn-images-1.medium.com/max/800/1*qCNSEjR44zyoXfBwIB_SdA.jpeg"><figcaption class="imageCaption">Uma gaveta individual do cofre, como a sua (ou, se preferir, um Context como o seu)</figcaption></figure><p name="f963" id="f963" class="graf graf--p graf-after--figure">Uma vez que a memória (o Container) é carregada, o Context expõe os objetos do seu app como eles foram deixados da última vez e “anota” todas as modificações que se faça sobre cada um. É o Context quem permite que façamos undo/redo, inclusive, mas ele representa apenas uma memória temporária, que se apaga com o desligamento do app a menos que seja salvo em um Container outra vez. E, assim como dentro do grande cofre existem várias gavetas, dentro de um Container vários Contexts podem existir!</p><p name="9600" id="9600" class="graf graf--p graf-after--p">Vamos parar por um momento e recapitular. Já sabemos que você tem uma gaveta para guardar objetos de valor, e que ela fica dentro do cofre de um banco. Mas embora ela seja sua, você não pode, por razões óbvias, entrar e sair do cofre na hora que quiser. Para poder acessar a sua gaveta, há no banco um gerente que ajuda com isso. Igualmente, para acessar o Context que guardou seu objeto num Container, você precisa de um:</p><p name="3f3f" id="3f3f" class="graf graf--p graf-after--p"><a href="https://developer.apple.com/documentation/coredata/nspersistentstorecoordinator" data-href="https://developer.apple.com/documentation/coredata/nspersistentstorecoordinator" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">NSPersistentStoreCoordinator</strong></a>: Essa classe existe, basicamente, para fazer a comunicação entre aquelas duas partes. Tudo isso se resume no quadro abaixo.</p><figure name="6d08" id="6d08" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*I-3icezQR5J5xfJumaqw5g.png" data-width="1088" data-height="570" alt="Imagem de um grande retângulo representado o Container e um menor representando o Context dentro dele." src="https://cdn-images-1.medium.com/max/800/1*I-3icezQR5J5xfJumaqw5g.png"><figcaption class="imageCaption">Até agora, isso é o que vimos.</figcaption></figure><p name="036c" id="036c" class="graf graf--p graf-after--figure"><em class="markup--em markup--p-em">(Antes de prosseguirmos, vale um pequeno esclarecimento: quando estamos tratando de Core Data, chamamos as classes de modelo de um app de </em><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">entidades</em></strong><em class="markup--em markup--p-em">. Essas são as classes específicas do seu aplicativo: não as que são comuns a todos e foram criadas pela Apple (como ViewController), mas as que só existem no seu app e foram criadas por você.</em></p><p name="26b5" id="26b5" class="graf graf--p graf-after--p"><em class="markup--em markup--p-em">Imagine que o banco, para evitar fraudes, possui um arquivo com o perfil individual de todos os seus clientes. O template desse perfil é como uma classe (ou, no jargão de Core Data, uma entidade), que contém propriedades como &quot;nome&quot;, &quot;cpf&quot; e &quot;endereço&quot;. Em Core Data, cada uma dessas propriedades é chamada de </em><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">atributo</em></strong><em class="markup--em markup--p-em">. Voltaremos a falar disso em breve, ok?)</em></p><h4 name="6e7f" id="6e7f" class="graf graf--h4 graf-after--p">Parte 2: Os Itens</h4><p name="21a5" id="21a5" class="graf graf--p graf-after--h4">Entramos no banco, falamos com o gerente, fomos até o cofre e encontramos nossa gaveta. Agora que estamos com ela aberta, vamos pensar nos itens que você guardou lá dentro. Digamos que, por segurança, querendo evitar golpes, o banco mantenha um registro individual de todos os itens que cada cliente deixa em suas gavetas. Esse registro é o:</p><p name="9568" id="9568" class="graf graf--p graf-after--p"><a href="https://developer.apple.com/documentation/coredata/nsmanagedobjectmodel" data-href="https://developer.apple.com/documentation/coredata/nsmanagedobjectmodel" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">NSManagedObjectModel</strong></a>: o Model é como o inventário que o banco fez dos seus itens, descrevendo todos os objetos que foram guardados na sua gaveta do cofre. Na prática, o Model é como uma grande lista que contém as descrições de todas as entidades (ou classes) do seu app.</p><p name="898f" id="898f" class="graf graf--p graf-after--p">Dentro da sua gaveta (e descritos no seu Model) estão um punhado de joias, duas ou três barras de ouro e o objeto mais valioso da sua vida: o antigo livro de receitas da família! (Convenhamos que nem só de dinheiro é feita a felicidade do homem). Abrimos a antiga capa de couro e, logo na primeira página, vemos um sumário de todas as receitas já escritas. O bolo de rolo com açucar de Dona Maria, o cuscuz com galinha guisada de Seu Geraldo…</p><figure name="2d51" id="2d51" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*zyV1I54ylL4qSmMJQW_PEQ.jpeg" data-width="1280" data-height="853" src="https://cdn-images-1.medium.com/max/800/1*zyV1I54ylL4qSmMJQW_PEQ.jpeg"><figcaption class="imageCaption">O livro de receitas</figcaption></figure><p name="628a" id="628a" class="graf graf--p graf-after--figure">No entanto, embora todas elas possuam características em comum, como ter uma lista de ingredientes ou o passo-a-passo do preparo, cada receita exige insumos próprios e um jeito particular de se fazer. Podemos entender cada receita como uma entidade, que deve conter dentro de si uma:</p><p name="cc82" id="cc82" class="graf graf--p graf-after--p"><a href="https://developer.apple.com/documentation/coredata/nsentitydescription" data-href="https://developer.apple.com/documentation/coredata/nsentitydescription" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">NSEntityDescription</strong></a>: é como uma lista menor com todos os <em class="markup--em markup--p-em">atributos</em> (as propriedades) de uma entidade particular. No caso da nossa receita, os atributos poderiam ser entendidos como os ingredientes necessários. Essa lista diz não apenas quais são as características daquela entidade específica, mas também quais as <em class="markup--em markup--p-em">relações</em> que ela tem possui outras entidades.</p><p name="8c03" id="8c03" class="graf graf--p graf-after--p">(Um exemplo de relação entre entidades seria entre as entidades &quot;cofre&quot; e &quot;gaveta&quot;. Um cofre <em class="markup--em markup--p-em">é formado</em> por várias gavetas, assim como várias gavetas <em class="markup--em markup--p-em">formam</em> um cofre. Essas são as relações que as duas entidades mantêm).</p><p name="792d" id="792d" class="graf graf--p graf-after--p">Se o EntityDescription lista todas as propriedades, cada uma delas é descrita e representada pela classe:</p><p name="3a7e" id="3a7e" class="graf graf--p graf-after--p"><a href="https://developer.apple.com/documentation/coredata/nspropertydescription" data-href="https://developer.apple.com/documentation/coredata/nspropertydescription" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">NSPropertyDescription</strong></a>: é a classe que representa cada propriedade unitária de um atributo. No caso da receita, seria o equivalente às especificações dos ingredientes que vamos usar. As propriedades possuem sempre um nome e um tipo. Todo ingrediente de uma receita, por exemplo, possui um nome e uma medida correta em gramas. Na linguagem de Core Data, dizemos que todo atributo &quot;ingrediente&quot; da entidade &quot;receita&quot; possui uma propriedade &quot;<em class="markup--em markup--p-em">nome: string&quot;</em> e uma propriedade &quot;<em class="markup--em markup--p-em">medidaCorretaEmGramas: double&quot;</em>.</p><p name="4fff" id="4fff" class="graf graf--p graf-after--p">Por fim, só falta juntarmos isso tudo. Vários ingredientes formam uma receita, várias receitas formam um livro, e esse livro é um…</p><p name="15f5" id="15f5" class="graf graf--p graf-after--p"><a href="https://developer.apple.com/documentation/coredata/nsmanagedobject" data-href="https://developer.apple.com/documentation/coredata/nsmanagedobject" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">NSManagedObject</strong></a>: é a classe que representa um objeto individual criado a partir das descrições de uma entidade. Aqui, porém, vale um aviso! Diferentemente do que ocorre com as outras classes, não é comum vermos &quot;NSManagedObject&quot; escrito no código. O mais comum é que, para representar as entidades desejadas, se criem classes específicas que herdam propriedades de NSManagedObject! A razão disso é que é mais fácil codar mudanças nas classes criadas do que em NSManagedObject em si :)</p><p name="0a35" id="0a35" class="graf graf--p graf-after--p">Todas essas relações estão descritas abaixo.</p><figure name="265b" id="265b" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*5Hvp0xvWgDDfrHrDio7nFg.png" data-width="2438" data-height="1304" src="https://cdn-images-1.medium.com/max/800/1*5Hvp0xvWgDDfrHrDio7nFg.png"></figure><p name="ff5c" id="ff5c" class="graf graf--p graf-after--figure">A implementação de Core Data não costuma ser difícil, e os vários tutoriais disponíveis pela internet mostram isso. No entanto, agora que você entende a lógica por trás da aplicação, implementar será bem mais tranquilo.</p><p name="3d07" id="3d07" class="graf graf--p graf-after--p graf--trailing">Até a próxima!</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@ofelipebandeira" class="p-author h-card">Felipe Bandeira</a> on <a href="https://medium.com/p/d543cd19118"><time class="dt-published" datetime="2020-09-02T18:59:13.982Z">September 2, 2020</time></a>.</p><p><a href="https://medium.com/@ofelipebandeira/swift-para-amadores-qual-a-l%C3%B3gica-por-tr%C3%A1s-de-core-data-d543cd19118" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on October 4, 2023.</p></footer></article></body></html>